DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Queries.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201510010029257_InitialMigration'
BEGIN
    CREATE TABLE [dbo].[Authors] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Authors] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Courses] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](255) NOT NULL,
        [Description] [nvarchar](2000) NOT NULL,
        [Level] [int] NOT NULL,
        [FullPrice] [real] NOT NULL,
        [AuthorId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Courses] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_AuthorId] ON [dbo].[Courses]([AuthorId])
    CREATE TABLE [dbo].[Covers] (
        [Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.Covers] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_Id] ON [dbo].[Covers]([Id])
    CREATE TABLE [dbo].[Tags] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Tags] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[CourseTags] (
        [CourseId] [int] NOT NULL,
        [TagId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.CourseTags] PRIMARY KEY ([CourseId], [TagId])
    )
    CREATE INDEX [IX_CourseId] ON [dbo].[CourseTags]([CourseId])
    CREATE INDEX [IX_TagId] ON [dbo].[CourseTags]([TagId])
    ALTER TABLE [dbo].[Courses] ADD CONSTRAINT [FK_dbo.Courses_dbo.Authors_AuthorId] FOREIGN KEY ([AuthorId]) REFERENCES [dbo].[Authors] ([Id])
    ALTER TABLE [dbo].[Covers] ADD CONSTRAINT [FK_dbo.Covers_dbo.Courses_Id] FOREIGN KEY ([Id]) REFERENCES [dbo].[Courses] ([Id])
    ALTER TABLE [dbo].[CourseTags] ADD CONSTRAINT [FK_dbo.CourseTags_dbo.Courses_CourseId] FOREIGN KEY ([CourseId]) REFERENCES [dbo].[Courses] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[CourseTags] ADD CONSTRAINT [FK_dbo.CourseTags_dbo.Tags_TagId] FOREIGN KEY ([TagId]) REFERENCES [dbo].[Tags] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201510010029257_InitialMigration', N'Queries.Migrations.Configuration',  0x1F8B0800000000000400ED1BD96EE336F0BD40FF41D0535B642D278B05DAC0DE45EA2445D0CDD13859F46DC14863472845A92215D828FA657DE827F5174AEA160F5D71926D5004086292730F678633CE3F7FFD3DFBB009B0F50031F54332B7F72753DB02E2869E4FD6733B61AB37DFDB1FDE7FFDD5ECC40B36D6A7E2DC5B718E43123AB7EF198B0E1D87BAF710203A097C370E69B86213370C1CE485CEC174FA83B3BFEF004761735C9635BB4E08F303483FF08F8B90B810B104E1F3D0034CF375BEB34CB15A1728001A2117E6F62F09C43E50DB3AC23EE2E4978057B685080919629CB9C35B0A4B168764BD8CF802C237DB08F8B915C21472A60FABE37DF99F1E08FE9D0AB040E5269485C14084FB6F73853832F828B5DAA5C2B8CA4EB86AD956489DAA6D6E1F25EC3E8C6D4B2675B8C0B13856EA74929DDCB3F2CF7BA5C1B95F889F3D6B916096C4302790B018E13DEB2AB9C3BEFB336C6FC2DF80CC4982719D1BCE0FDF6B2CF0A5AB388C2066DB6B58E53C9E79B6E534E11C19B004ABC164FC9F11F6F6C0B62E38717487A134764DD6250B63F80908C488817785188398081C90AA4BA12ED112BF0B6ADCBBF8EDB0AD73B4F90864CDEEE736FFD3B64EFD0D78C54ACEC12DF1F965E2402C4E402172811EFC75CA9F446E112631154E7E0D38DDA7F77E94F9FA24DBFB5C58F5340E83EB109740F9C6E71B14AF81719E43DDEE927F722586664EE53AAD0E95A1EAE350D9C9FF1D6AB0431DBC7BD7CBA1140EDBA91E0375633FCA028D99F8743A7D0AEA1FE10170978ADB519CF2E357B1EF56BAE3CCE3E1AC64D7A0DBE07D2F6C711BC7DFD7E246EAEF6B719BFB07109ED3DBD8C90F28DCA4EB2666B2CDA1BCDCA0756B24CBF6154EC4B28991744FC7C7801896CADF2784F183AF27820DCB40E33DC8907E9AEE35CA72DCF67DECC68FBD1EABBDE642A6EDFA1BBCA8111AFA38D111A5A1EBA70C34182BA272539A13E259AD213AD35E2503572177273FE20EC489CFEDEF14059950960256288B44D144B9AFA0E43E07B1303AC2FCFD44B917FB84A90EEA13D78F106EA32E01F5F46BA1ED12BDBC730C1110E1926D8AEC43B74AD42AF5928874DFBA3433736AFED0CB4DB258D7615229757639896A5103468D8FE4B1F7295DA421CDF3794843E4F1649FCF35D2F0D561C76629B383E8D10C8E15C23437B662330A98054EAE14C65502712EE4154E58281661C33459F796429E78699E1964C605D225B0C66DE6E1BE0AD352D453246F2228F38982A0D0652702D1ECD2C2A757AA033C4B560A70AA7709B4A66799FFF231503BA37D2DC87EDD95994A766B9A522E47572EAA2129ED2597344DE1FA0B9E6BD928B726D07687DA715237836B0347E622BB9239F319A3C86A00E90C21E3046E048D1A8A8CBFDED2163556192AAA6EAD93B56B8BB6AE63E8EBCECE5114F1CAB3D6E7CD57AC65D6E45DBC590E6F8406190EC7A59A7E68C96D4989D7D1680DD2AE509607A77E4CD93162E80E8990B2F002E55823301A624641AA19FB543B15C1A4382FFECE609A8D594D3ECC414EB92881C8A5E9EB40B9C02A60DA5A4718C59AA7C822C44940CCD9D50C9D3D2EEAF0D98A8A61E6489C2B195C518BE49FB2967BD9A0B82D636C902798E1363001BEB40D4C181A4DC23AA2C6467F7C79DBAF8E295FEA8FA3D6F7ABE3A92DF7C7553D29EAA8CC0F8D17F4D634118D73564D1EEDE5AB5AB8C7B9EA0BA9CF9058BB9527AAB9E1AAD342BDF41D7F6AD537AB045DB0CDCB1F533CCDB7F53153A35251D6687B4C8D0A49D5432F2B6498F42FCA1ADD612C19DFB2BD58E22886F123576EAAD994024E3E523A4D59C84905DB2C2F9EBAA7F54A35951DB12DCEFB83EF894A6AB9A50C8289383059FE8E17D8E76E5A1D3847C45F0165595BD63E98EE1F48B3FF2F670EEF50EA614DF1A90EE39FBDB3EC0B9D76F68E074ED1EACD64F28062F71EC5DF0468F36D1D93DA301E3A687EBDCA5267BE8F1FE8EA71A723DDC7CC6B539D3C765A1B03C28F9ED5A69C28ADA833E2C1666EFF91021D5A67BF7E2EE0F6ACCB980792436B6AFDD9417CE0F8F0651CB387E84F23B4928E5FD55DDC7DE01AA9AF962A443DACAD0FBAF55BD118E65805DC00F75289E73C0FA39C02EDC0ABC78E028B96ED88499DDC891B35031835CB31F68D9E687CF3CA467A8F9EE2A5CDEEAEB9DD7432D9E9E8EE79CCADEF2F7C99F339EDB3709CB565492EC9316060601DB9D9AB6381A88B3C35068A075B3BFD7488A4B0D03DD2FB2F788BE1353F34FF3DB7DFE8DEEE35BBC916D3D8EA55794C5F0B3EABBB183B243BF715FD885C1D1819BA93D257458D23F0AC4532B7BDBB905B372B704C8358FD7CBC653CAE436E9821EA67E7E6D1B91EB57696AA19AB9BA6EA3AACDA89A55E157ACCB53DB342B4549E76AADFF48DFA04AF7BBEAB190B7F6973FB1E2CEA0A28653EB1D3D17C39556F9DD01B3ACB3B1051F252A9FDBD5B518BE97FBBA8FA8EB59CF7A4D1C7F30839E0CB076A8F9A87FEDAFF9DF1B443FD758542FC171A01B711F4CB3367641516A947E2A838223D72CF81218F6784A398F92BE432BEED02A5E9176E3F219CF02327C11D7867E4326151C2B8C810DCE1C61778450E6BA39F7EC3A2C9F3EC326D06D25D88C0D9F4B90870497E4C7CEC957C9F6A5EDB06142239E67D1B614B26FA37EB6D89E922243D11E5EA2B73FA0D0411E6C8E82559A20718C3DB2D858FB046EEB618359891741BA2A9F6D9B18FD6310A688EA382E71FB90F7BC1E6FDBF90F465067E390000 , N'6.1.3-40302')
END

